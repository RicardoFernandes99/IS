{
  "Name": "ExtrairColocadosIPVC",
  "CreationDate": "2025-9-24",
  "Commands": [
    {
      "Command": "open",
      "Target": "https://dges.gov.pt/coloc/2025/col1listas.asp",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "clickAndWait",
      "Target": "linkText=Ensino Superior Público Universitário",
      "Value": "",
      "Targets": [
        "linkText=Ensino Superior Público Universitário",
        "xpath=/html/body/div/table/tbody/tr/td/div[2]/table[2]/tbody/tr/td/ul/li/a",
        "xpath=//a",
        "css=body > div > table > tbody > tr > td > div:nth-child(5) > table:nth-child(4) > tbody > tr:nth-child(1) > td > ul > li > a"
      ],
      "Description": ""
    },
    {
      "Command": "store",
      "Target": "61",
      "Value": "institutionIndex",
      "Description": "Start with institution index 61"
    },
    {
      "Command": "while_v2",
      "Target": "${institutionIndex} <= 65",
      "Value": "",
      "Description": "Loop through institutions from 61 to 65"
    },
    {
      "Command": "storeText",
      "Target": "xpath=/html/body/div/table/tbody/tr/td/div[2]/form/table[2]/tbody/tr/td/select/option[${institutionIndex}+1]",
      "Value": "institutionName",
      "Description": "Get the name of the institution at index+1"
    },
    {
      "Command": "select",
      "Target": "xpath=/html/body/div/table/tbody/tr/td/div[2]/form/table[2]/tbody/tr/td/select",
      "Value": "index=${institutionIndex}",
      "Description": "Select institution by current index"
    },
    {
      "Command": "store",
      "Target": "${institutionName}",
      "Value": "!csvLine",
      "Description": "Store institution name as a header line in CSV"
    },
    {
      "Command": "echo",
      "Target": "Saved institution to CSV: ${institutionName}",
      "Value": "",
      "Description": "Debug institution name being saved"
    },
    {
      "Command": "csvSave",
      "Target": "AlunosColocadosIPVC.csv",
      "Value": "",
      "Description": "Save institution name to CSV"
    },
    {
      "Command": "echo",
      "Target": "Processing institution at index ${institutionIndex}",
      "Value": "",
      "Description": "Debug output"
    },
    {
      "Command": "clickAndWait",
      "Target": "xpath=/html/body/div/table/tbody/tr/td/div[2]/form/table[2]/tbody/tr[2]/td/input[4]",
      "Value": "",
      "Targets": [
        "name=listagem",
        "xpath=/html/body/div/table/tbody/tr/td/div[2]/form/table[2]/tbody/tr[2]/td/input[4]",
        "xpath=//input[@name='listagem' and @value='Lista de Colocados']",
        "xpath=//input[4]",
        "css=body > div > table > tbody > tr > td > div:nth-child(5) > form > table.caixa > tbody > tr:nth-child(2) > td > input:nth-child(4)"
      ],
      "Description": ""
    },
    {
      "Command": "waitForElementPresent",
      "Target": "name=CodCurso",
      "Value": "30000",
      "Description": "Wait for course dropdown to appear"
    },
    {
      "Command": "store",
      "Target": "0",
      "Value": "i",
      "Description": ""
    },
    {
      "Command": "storeXpathCount",
      "Target": "xpath=//select[@name='CodCurso']/option",
      "Value": "courseCount",
      "Description": "Count how many courses for this institution"
    },
    {
      "Command": "echo",
      "Target": "Found ${courseCount} courses for institution ${institutionIndex}",
      "Value": "",
      "Description": "Debug output"
    },
    {
      "Command": "while_v2",
      "Target": "${i} < ${courseCount}",
      "Value": "",
      "Description": "Loop through all courses for this institution"
    },
    {
      "Command": "select",
      "Target": "name=CodCurso",
      "Value": "index=${i}",
      "Description": "Select course by index"
    },
    {
      "Command": "storeText",
      "Target": "xpath=//select[@name='CodCurso']/option[${i}+1]",
      "Value": "currentCourse",
      "Description": "Get current course name"
    },
    {
      "Command": "echo",
      "Target": "Processing course ${i}: ${currentCourse}",
      "Value": "",
      "Description": "Debug message"
    },
    {
      "Command": "clickAndWait",
      "Target": "name=search",
      "Value": "",
      "Targets": [
        "name=search",
        "xpath=/html/body/div/table/tbody/tr/td/div[2]/form/table[2]/tbody/tr[2]/td/input[3]",
        "xpath=//input[@name='search']",
        "xpath=//input[3]",
        "css=body > div > table > tbody > tr > td > div:nth-child(5) > form > table.caixa > tbody > tr:nth-child(2) > td > input:nth-child(3)"
      ],
      "Description": ""
    },
    {
      "Command": "storeText",
      "Target": "xpath=/html/body/div/table/tbody/tr/td/div[2]/table/tbody/tr[2]/td",
      "Value": "!csvLine",
      "Description": ""
    },
    {
      "Command": "csvSave",
      "Target": "AlunosColocadosIPVC.csv",
      "Value": "",
      "Description": ""
    },
    {
      "Command": "storeText",
      "Target": "xpath=/html/body/div/table/tbody/tr/td/div[2]/table[2]",
      "Value": "!csvLine",
      "Description": ""
    },
    {
      "Command": "storeText",
      "Target": "xpath=/html/body/div/table/tbody/tr/td/div[2]/table[3]",
      "Value": "!csvLine",
      "Description": ""
    },
    {
      "Command": "csvSave",
      "Target": "AlunosColocadosIPVC.csv",
      "Value": "",
      "Description": "Save to IPVC file"
    },
    {
      "Command": "executeScript",
      "Target": "document.querySelector('a[href=\"javascript:voltar()\"]').click();",
      "Value": "",
      "Description": "Go back to course selection"
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "return Number(${i}) + 1;",
      "Value": "i",
      "Description": "Increment course index"
    },
    {
      "Command": "end",
      "Target": "",
      "Value": "",
      "Description": "End course loop"
    },
    {
      "Command": "clickAndWait",
      "Target": "linkText=Voltar",
      "Value": "",
      "Description": "Go back to institution selection"
    },
    {
      "Command": "executeScript_Sandbox",
      "Target": "return Number(${institutionIndex}) + 1;",
      "Value": "institutionIndex",
      "Description": "Increment institution index"
    },
    {
      "Command": "end",
      "Target": "",
      "Value": "",
      "Description": "End institution loop"
    }
  ]
}